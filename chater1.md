## 자바 8

현대 기술이 빠르게 발전하면서 멀티코어 CPU를 탑재한 프로세서들이 나타났다. **자바 8 이전까지는 대부분의 자바 프로그램이 하나의 코어만 사용했고, 나머지는 idle 상태로 두거나 운영체제나 바이러스 검사 프로그램과 프로세스 파워를 나눠서 사용했다.**

자바 8 등장 이전에는 멀티코어를 사용하려면 스레드를 사용하는 것이 좋다고 했을 것이다. 하지만 **스레드는 관리하기 어렵고, 많은 문제가 발생할 수 있다.**

### 자바 8에서 추가된 기능

1. **Stream API**
2. **메서드에 코드를 전달하는 기법**
3. **인터페이스의 디폴트 메서드**

## Stream

Stream API는 **한 번에 한 개씩 만들어지는 연속적인 데이터 항목들의 모임**이다. 그래서 어떤 프로그램의 출력 스트림은 다른 프로그램의 입력 스트림이 될 수 있다.

```bash
cat file | tr "[A-Z]" "[a-z]" | sort | tail -3
```

여기서 `cat file`의 결과(출력 스트림)는 `tr`의 입력(입력 스트림)이 되어 데이터가 흘러간다. 이처럼 cat이나 tr이 완료되지 않은 시점에서 sort가 행을 처리하기 시작할 수 있다. 또한 병렬적으로 처리된다.

### Stream API의 장점

**작업을 고수준으로 추상화해서 일련의 스트림으로 만들어 처리할 수 있다는 것이다.** 스트림 파이프라인을 이용해서 입력 부분을 여러 CPU 코어에 쉽게 할당할 수 있다는 부가적인 이득도 얻을 수 있다. **스레드라는 복잡한 작업을 사용하지 않으면서도 공짜로 병렬성을 얻을 수 있다.**

### 병렬 처리의 조건

**공유 가변 데이터에 접근하지 않아야 한다는 것이다.**

그 이유는 병렬적으로 처리하기 위해 여러 스레드가 동시에 실행되는데, 동시에 접근하여 바꾼다면 부정확한 결과를 가져다 줄 수 있기 때문이다. 그렇기 때문에 병렬처리를 위해서는 **순수함수로 작성되어야 한다.**

**순수 함수란?**

- 입력이 같으면 항상 같은 출력을 보장하는 함수
- 외부 상태를 변경하거나 의존하지 않는 함수
- 이러한 함수를 순수 함수, 부작용 없는 함수, 상태 없는 함수라고 부른다

**synchronized는 비싼 비용이 든다.** Stream API는 이런 동기화 비용 없이 안전한 병렬 처리를 가능하게 한다.

### 스트림 처리 예제

**스트림은 스트림 내의 요소를 쉽게 병렬로 처리할 수 있는 환경을 제공한다**

**순차 처리 예제**

```java
List<Apple> heavyApples = inventory.stream()
    .filter(a -> a.getWeight() > 150)
    .collect(toList());
```

**병렬 처리 예제**

```java
List<Apple> heavyApples = inventory.parallelStream()
    .filter(a -> a.getWeight() > 150)
    .collect(toList());
```

## 동작 파라미터화로 메서드에 코드 전달하기

우리는 기존에 Comparator를 어떻게 구현했나 기억해보자.

```java
List<String> fruits = Arrays.asList("banana", "apple", "cherry", "date");

Collections.sort(fruits, new Comparator<String>() {
    @Override
    public int compare(String s1, String s2) {
        return s1.length() - s2.length(); // 길이순 정렬
    }
});
```

sort 함수에 Comparator 객체를 만들어서 sort에 넘겨주는 방법도 있지만 **너무 복잡하고, 재활용한다는 측면에서도 맞지 않다.**

함수를 직접 정의하여 sort의 인수로 전달하는 방법으로 해결할 수 있다.

### 일급값으로서의 함수

자바 8에서는 **함수를 새로운 값의 형식으로 추가했다.** 이는 멀티코어에서 병렬 프로그래밍을 활용할 수 있는 스트림과 연계될 수 있도록 함수를 만들었기 때문이다.

자바에서 조작할 수 있는 값은 primitive 자료형(기본값)과 객체(정확히는 객체의 참조)이다. 이 값들은 **일급 값**이라고 부른다. 하지만 프로그램을 실행하는 동안 이러한 모든 구조체를 자유롭게 전달할 수는 없다. 이렇게 전달할 수 없는 구조체는 **이급 시민**이다. 자바 메서드, 클래스 등은 이급 시민에 해당한다.

**메서드를 일급 시민으로 만들면 프로그래밍에 유용하게 활용될 수 있다.** 자바 8에서 메서드를 값으로 취급할 수 있는 기능은 스트림 같은 다른 자바 8 기능의 토대를 제공했다.

## 디폴트 메서드

**자바 8에서 디폴트 메서드를 제공한다.** 이것은 자바 8에서 스트림이 나오면서부터 시작되었다.

기존에는 컬렉션에서 stream 메서드를 제공하지 않았다. 스트림이 만들어지면서 **컬렉션에 스트림을 사용할 수 있게 해야 하는데, 해당 인터페이스를 구현하는 모든 클래스를 업데이트해야 하는 불편함이 있었다.** 이 방법은 많은 것을 구현해야 하기 때문에 불가능에 가까웠다. 그래서 나온 것이 디폴트 메서드다.

**디폴트 메서드는 인터페이스에 구현체를 넣을 수 있는 방식이다.** 이 방식으로 기존 컬렉션 인터페이스에 `stream()`을 추가한 후 구현체를 넣어 해결했다.

### 디폴트 메서드의 장점

**디폴트 메서드를 통해서 기존 코드를 건들이지 않고 원래 인터페이스 설계를 자유롭게 확장할 수 있다.** 특정 프로그램을 구현하는 데 도움을 주는 기능이 아니라 미래에 프로그램이 쉽게 변화할 수 있는 환경을 제공하는 기능이다.

```java
public interface TestFunction<E> {

    default E fn() {
        // 구현
    }
}
```

## 자바 9: 모듈 시스템

자바 9에서는 **모듈을 정의하는 문법을 제공하므로 이를 이용해 패키지 모음을 포함하는 모듈을 정의할 수 있다.** 모듈 덕분에 JAR 같은 컴포넌트에 구조를 적용할 수 있으며 문서화와 모듈 확인 작업이 용이해졌다.
